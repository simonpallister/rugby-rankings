{"version":3,"sources":["../../../../components/RankingsCalculator.tsx/__nextjs-internal-proxy.mjs","../../../../app/page.tsx","../../../../lib/api.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/RankingsCalculator.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/RankingsCalculator.tsx\",\n    \"default\",\n);\n","import RankingsCalculator from \"@/components/RankingsCalculator\";\nimport { fetchRankings, fetchFixtures, transformFixtures } from \"@/lib/api\";\n\nexport default async function Home() {\n  // Fetch data server-side\n  const { rankings, effectiveTime } = await fetchRankings();\n  const rankingsTime = new Date(effectiveTime).getTime();\n\n  // Calculate date range (1 month ago to 6 months ahead)\n  const now = Date.now();\n  const oneMonthAgo = new Date(now - 30 * 24 * 60 * 60 * 1000);\n  const sixMonthsLater = new Date(now + 180 * 24 * 60 * 60 * 1000);\n\n  const startDate = oneMonthAgo.toISOString().split(\"T\")[0];\n  const endDate = sixMonthsLater.toISOString().split(\"T\")[0];\n\n  // Fetch fixtures\n  const fixturesData = await fetchFixtures(startDate, endDate);\n\n  // Get ranked team IDs for filtering\n  const rankedTeamIds = new Set(rankings.map((r) => r.team.id));\n\n  // Transform and filter fixtures\n  const allFixtures = transformFixtures(\n    { content: fixturesData },\n    rankingsTime,\n    rankedTeamIds\n  );\n\n  // Split into completed and upcoming\n  const oneWeekFromNow = now + 7 * 24 * 60 * 60 * 1000;\n\n  const completedFixtures = allFixtures.filter(\n    (f) => f.homeScore !== null && f.awayScore !== null\n  );\n\n  const upcomingFixtures = allFixtures.filter(\n    (f) =>\n      (f.homeScore === null || f.awayScore === null) &&\n      new Date(f.date || 0).getTime() >= now &&\n      new Date(f.date || 0).getTime() <= oneWeekFromNow\n  );\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-green-50 to-gray-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900\">\n      {/* Header */}\n      <header className=\"bg-white dark:bg-gray-800 shadow-md border-b-4 border-green-600\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <h1 className=\"text-4xl font-bold text-gray-900 dark:text-white\">\n            World Rugby Rankings Calculator\n          </h1>\n          <p className=\"mt-2 text-gray-600 dark:text-gray-400\">\n            Calculate how match results affect World Rugby rankings\n          </p>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <RankingsCalculator\n          initialRankings={rankings}\n          completedFixtures={completedFixtures}\n          upcomingFixtures={upcomingFixtures}\n        />\n\n        {/* Footer */}\n        <footer className=\"mt-12 text-center text-sm text-gray-500 dark:text-gray-400\">\n          <p>\n            Rankings calculation based on{\" \"}\n            <a\n              href=\"https://www.world.rugby/tournaments/rankings/explanation\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-green-600 dark:text-green-400 hover:underline\"\n            >\n              World Rugby methodology\n            </a>\n          </p>\n          <p className=\"mt-2\">\n            Data from{\" \"}\n            <a\n              href=\"https://www.world.rugby/rankings\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-green-600 dark:text-green-400 hover:underline\"\n            >\n              World Rugby\n            </a>\n            {\" â€¢ \"}\n            Inspired by{\" \"}\n            <a\n              href=\"https://rawling.github.io/wr-calc/\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-green-600 dark:text-green-400 hover:underline\"\n            >\n              rawling/wr-calc\n            </a>\n          </p>\n        </footer>\n      </main>\n    </div>\n  );\n}\n","import { Ranking, Fixture, Team } from \"@/types\";\n\nexport interface WRRankingEntry {\n  team: {\n    id: number;\n    name: string;\n    abbreviation: string;\n  };\n  pts: number;\n  pos: number;\n  previousPts: number;\n  previousPos: number;\n}\n\nexport interface WRRankingsResponse {\n  entries: WRRankingEntry[];\n  label: string;\n  effectiveTime: string;\n}\n\nexport interface WRMatch {\n  matchId?: string;\n  id?: number;\n  time: {\n    label: string;\n    millis: number;\n  };\n  teams: Array<{\n    id: number;\n    name: string;\n    abbreviation: string;\n    score?: number;\n  }>;\n  status: string;\n  venue?: {\n    name: string;\n    city: string;\n    country: string;\n  };\n  events?: Array<{\n    id: number;\n    label: string;\n    rankingsWeight: number;\n  }>;\n}\n\nexport interface WRFixturesResponse {\n  content: WRMatch[];\n}\n\n/**\n * Transform World Rugby rankings API response to internal format\n */\nexport function transformRankings(data: WRRankingsResponse): Ranking[] {\n  return data.entries.map((entry) => ({\n    team: {\n      id: entry.team.id.toString(),\n      name: entry.team.name,\n      abbreviation: entry.team.abbreviation,\n    },\n    pts: entry.pts,\n    pos: entry.pos,\n    previousPts: entry.previousPts,\n    previousPos: entry.previousPos,\n  }));\n}\n\n/**\n * Transform World Rugby fixtures API response to internal format\n */\nexport function transformFixtures(\n  data: WRFixturesResponse,\n  rankingsTime: number,\n  rankedTeamIds: Set<string>\n): Fixture[] {\n  return data.content\n    .filter((match) => {\n      // Only include future matches or matches that happened after the rankings date\n      return (\n        match.status !== \"C\" || match.time.millis > rankingsTime\n      );\n    })\n    .filter((match) => {\n      // Only include matches with two teams\n      return match.teams.length === 2;\n    })\n    .filter((match) => {\n      // Only include matches where both teams are in the rankings (international test matches)\n      const team1Id = match.teams[0].id.toString();\n      const team2Id = match.teams[1].id.toString();\n      return rankedTeamIds.has(team1Id) && rankedTeamIds.has(team2Id);\n    })\n    .map((match) => {\n      const homeTeam: Team = {\n        id: match.teams[0].id.toString(),\n        name: match.teams[0].name,\n        abbreviation: match.teams[0].abbreviation,\n      };\n\n      const awayTeam: Team = {\n        id: match.teams[1].id.toString(),\n        name: match.teams[1].name,\n        abbreviation: match.teams[1].abbreviation,\n      };\n\n      const isRwc = match.events?.some((e) => e.rankingsWeight === 2) || false;\n\n      return {\n        id: match.matchId || match.id?.toString() || `${match.time.millis}`,\n        homeTeam,\n        awayTeam,\n        homeScore: match.teams[0].score ?? null,\n        awayScore: match.teams[1].score ?? null,\n        isRwc,\n        noHome: false, // This would need venue detection logic\n        date: new Date(match.time.millis).toISOString(),\n      };\n    });\n}\n\n/**\n * Fetch rankings from World Rugby API (server-side)\n */\nexport async function fetchRankings(): Promise<{\n  rankings: Ranking[];\n  effectiveTime: string;\n}> {\n  const response = await fetch(\n    \"https://api.wr-rims-prod.pulselive.com/rugby/v3/rankings/mru?language=en&client=pulse\",\n    {\n      headers: {\n        Accept: \"application/json\",\n      },\n      next: { revalidate: 3600 }, // Cache for 1 hour\n    }\n  );\n\n  if (!response.ok) {\n    throw new Error(\"Failed to fetch rankings\");\n  }\n\n  const data: WRRankingsResponse = await response.json();\n  return {\n    rankings: transformRankings(data),\n    effectiveTime: data.effectiveTime,\n  };\n}\n\n/**\n * Fetch fixtures from World Rugby API (server-side)\n */\nexport async function fetchFixtures(\n  startDate: string,\n  endDate: string\n): Promise<WRMatch[]> {\n  const allMatches: WRMatch[] = [];\n  let page = 0;\n  let hasMore = true;\n\n  // Fetch all pages of fixtures\n  while (hasMore) {\n    const url = `https://api.wr-rims-prod.pulselive.com/rugby/v3/match?startDate=${startDate}&endDate=${endDate}&sort=asc&pageSize=100&page=${page}`;\n\n    const response = await fetch(url, {\n      headers: {\n        Accept: \"application/json\",\n      },\n      next: { revalidate: 3600 }, // Cache for 1 hour\n    });\n\n    if (!response.ok) {\n      throw new Error(\"Failed to fetch fixtures\");\n    }\n\n    const data = await response.json();\n    const matches = data.content || [];\n\n    allMatches.push(...matches);\n\n    // If we got less than 100 results, we've reached the last page\n    hasMore = matches.length === 100;\n    page++;\n  }\n\n  return allMatches;\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}